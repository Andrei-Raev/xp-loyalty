# Как запустить?

Для запуска необходимо установить golang и скомпилировать программу командой:
```
go build -v ./cmd/xp-loyalty
```
После этой команды в директории проекта появится бинарник.
Также необходимо установить mongodb и запустить его.
После этого можно запускать бинарник

# Как посмотреть доступные эндпоинты?
Необходимо запустить программу и перейти на url: ```http://localhost:{port}/swagger/index.html#/```
Порт задается в конфиге

# Конфиг
Для настройки проекта необходимо использовать конфигурационный файл ./config/config.json

# Как работает?

1. Модератор логинится со своим логином и паролем из конфига
2. Модератор создает админов (админы имеют доступ ко всем эндпоинтам, кроме эндпоинта на создание админа)
3. Админ или модератор создают **статичные** карты (про карты подробнее в пунте про [карты](#карты))
4. Пользователь регистрируется и логинится
5. Пользователь можно смотреть свой профиль и свои карты, аватар и изображения призов - эндпоинты: ```/api/cards/profile```, ```/api/users/profile```, ```/api/images/avatar```, ```/api/images/avatar``` (добавлять изображения может только модератор или админ)
6. Пользоавтель выполняет задания(карты), которые видит у себя в профиле.
7. После того, как пользователь выполнил задание частично или полностью, он подходит к админу, показывает, что выполнил задание и админ используя эндпоинт ```/api/cards/done``` отмечает, что карта выполнена полностью или частично.
8. Админ может посмотреть карты пользователя, используя эндпоинт ```/api/cards/{username}```

# Карты
1. Когда админ создает карты, они добавляются в общий список карт и больше не изменяются, будет называть такие карты **статичными** (только, если админ не решит удалить карту), все карты можно посмотреть по эндпоинту ```GET /api/cards```, удалить по эндпоинту ```DELETE /api/cards``` и создать по эндпоинту ```POST /api/cards```
2. После того, как админ создал **статичные** карты, они по определенному [алгоритму](#алгоритм-распределения-карт) распределяются между пользователями. В момент, когда карта присваивается пользователю, она становится уникальной, будет ее называть просто карта, она получает дополнительные свойства(поля), например, поле *done* или *progress*. Карта содержит в себе **статичную** карту(имеет все поля, что и **статичная** карта), таким образом 2 пользователя могут иметь 2 карты, который имеют одинаковые **статичные** карты внутри себя, однако поля типа *progress* или *done* будут отличаться.
3. **Статичные карты** бывают 3 типов: *ordinary*, *progress* и *options*, каждая карта может иметь *goal*, это поле принимает одно из следующих значений: *food*, *drink*, *play*, *social*, эти значения важны для [алгоритма](#алгоритм-распределения-карт) распределения *daily* карт. Каждая карта также может иметь одно из двух значений *pool*: *daily* и *const*, эти значения также учавствуют в алгоритме. Карты со значением *pool*=*const* также имеют 2 дополнительных обязательных поля: *chain_name* и *chain_order*. *chain_name* - может иметь любое значение, карты в одной "цепочке" должны иметь одно значение *chain_name*. *chain_order* - определяет порядок, в котором карты будут выводиться пользователю.

## Примеры:

1. Создание цепочки из 3 "ordinary" карт с одинаковым "goal"
```json
POST /api/cards {
    "title": "бла-бла-бла",
    "long_description": "бла-бла-бла",
    "short_description": "бла-бла-бла",
    "goal": "food",
    "pool": "const",
    "chain_name": "my first chain",
    "chain_order": 0,
    "type": "ordinary",
    "ordinary_settings": {
        "award": {
            "XPoints": 100,
            "prize": "Чашка",
            "prize_image_url": "/img/to/cup"
        }
    }
}

POST /api/cards {
    "title": "бла-бла-бла",
    "long_description": "бла-бла-бла",
    "short_description": "бла-бла-бла",
    "goal": "food",
    "pool": "const",
    "chain_name": "my first chain",
    "chain_order": 1,
    "type": "ordinary",
    "ordinary_settings": {
        "award": {
            "XPoints": 200,
            "prize": "Стул",
            "prize_image_url": "/img/to/chair"
        }
    }
}

POST /api/cards {
    "title": "бла-бла-бла",
    "long_description": "бла-бла-бла",
    "short_description": "бла-бла-бла",
    "goal": "food",
    "pool": "const",
    "chain_name": "my first chain",
    "chain_order": 2,
    "type": "ordinary",
    "ordinary_settings": {
        "award": {
            "XPoints": 300,
            "prize": "Нож",
            "prize_image_url": "/img/to/knife"
        }
    }
}
```

2. Создание "daily", "ordinary" карты

```json
POST /api/cards {
    "title": "бла-бла-бла",
    "long_description": "бла-бла-бла",
    "short_description": "бла-бла-бла",
    "goal": "food",
    "pool": "const",
    "type": "ordinary",
    "ordinary_settings": {
        "award": {
            "XPoints": 200,
            "prize": "Стул",
            "prize_image_url": "/img/to/chair"
        }
    }
}
```

3. Создание "daily", "progress" карты

```json
POST /api/cards {
    "title": "бла-бла-бла",
    "long_description": "бла-бла-бла",
    "short_description": "бла-бла-бла",
    "goal": "play",
    "pool": "daily",
    "type": "progress",
    "progress_settings": {
        "max_progress": 10,
        "award": {
            "XPoints": 50,
            "prize": "Ничего",
            "prize_image_url": "/img/to/nothing"
        }
    }
}

```

4. Создание "daily", "options" карты

```json
POST /api/cards {
    "title": "Отжаться",
    "long_description": "Отжаться определенное количество раз, чем больше, тем больше выигрышь",
    "short_description": "Отжаться определенное количество раз",
    "goal": "social",
    "pool": "daily",
    "type": "options",
    "options_settings": {
        "options": [10, 20],
        "awards": [
            {
                "XPoints": 50,
                "prize": "Ничего",
                "prize_image_url": "/img/to/nothing"
            },
            {
                "XPoints": 100,
                "prize": "Ничего",
                "prize_image_url": "/img/to/nothing"
            }
        ]
    }
}

```

# Алгоритм распределения карт
После создания **статичной** *const* карты, она почти сразу присваивается всем пользователям, эту карту можно выполнять неоднократно. После выполнения, она добавляется в список done в профиле, но при этом остается у пользователя и они могут выполнить их повторно. *daily* карты добавляются в количестве, указанном в конфиге, и с учетом уникальности *goal* (также, если указано в конфиге). *daily* карты добавляются раз в день случайным образом из списка **статичных** *daily* карт. Когда пользователь выполняет *daily* карту, она попадет в список done и пропадает из списка доступных на выполнение карт. В начале каждого нового дня, если у пользователя остались невыполненные карты, они удалются и ему добавляются новые *daily* карты, если он выполнил 2 из 3 карт, то одна карта удаляется, у пользователя остается 0 карт, ему добавляется 3 новых. При этом 2 выполненные сохраняются в список done.

# Задачи
* Необходимо добавить поддержку карт, которые можно будет выполнить лишь единожды
* Необходимо добавить интеграцию с API GIZMO, чтобы:
  * начислять пользователю очки в зависимости потраченных средств,
  * реализовать возможность аутентификации через учетные записи GIZMO;
 * Нужно протестировать работоспособность текущего и нового кода, поправить баги, если будут
